<!DOCTYPE html><html><head><meta charset="UTF-8" name="viewport" content="width=device-width"><title>Lemon自动AC机 - su226的博客</title><meta name="generator" content="Hexo 6.0.0"><meta name="description" content="废话我们机房最近每天都是模拟赛，但我又打不过，于是我动起了歪主意。 我在机房偷偷看手机时，写了第一个版本的自动AC机。那一个版本只适用于Windows，所以老师发的结果中我爆零。但老师在给另一个同学重测时我是满分，并且重测的截图明显是来自Windows，所以我推测老师是在Linux下打点的。 从截图和数据包来看，测评软件明显是Lemon，所以我在GitHub上下载了Lemon的修改版LemonPl"><meta property="og:type" content="article"><meta property="og:title" content="Lemon自动AC机"><meta property="og:url" content="https://su226.tk/2019/08/24/lemon-autoac/index.html"><meta property="og:site_name" content="su226的博客"><meta property="og:description" content="废话我们机房最近每天都是模拟赛，但我又打不过，于是我动起了歪主意。 我在机房偷偷看手机时，写了第一个版本的自动AC机。那一个版本只适用于Windows，所以老师发的结果中我爆零。但老师在给另一个同学重测时我是满分，并且重测的截图明显是来自Windows，所以我推测老师是在Linux下打点的。 从截图和数据包来看，测评软件明显是Lemon，所以我在GitHub上下载了Lemon的修改版LemonPl"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://i.loli.net/2019/08/24/xBsNAYiHe53JaD4.png"><meta property="og:image" content="https://i.loli.net/2019/08/24/njxKNEWcGfrs29M.jpg"><meta property="article:published_time" content="2019-08-23T16:00:00.000Z"><meta property="article:modified_time" content="2019-08-23T16:00:00.000Z"><meta property="article:author" content="su226"><meta property="article:tag" content="OI"><meta property="article:tag" content="C++"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://i.loli.net/2019/08/24/xBsNAYiHe53JaD4.png"><link rel="stylesheet" href="/css/normalize-8.0.1-min.css"><link rel="stylesheet" href="/css/waves-0.7.6-min.css"><link rel="stylesheet" href="/css/base.css"><link rel="stylesheet" href="/css/colors.css"><link rel="stylesheet" href="/css/info.css"><link rel="stylesheet" href="/css/post.css"></head><body><nav class="sidebar"><div class="sidebar-header color-blue"><img class="sidebar-avatar" src="https://avatars.githubusercontent.com/u/17371317?s=112"> <span class="sidebar-title">su226的博客</span> <span class="sidebar-subtitle">汪汪汪！（发出逼真的猫叫声） </span><button id="settings" class="btn-icon"><span class="iconify" data-icon="mdi:cog"></span></button></div><ul class="menu" id="menu"><li class="menu-item"><span class="menu-icon iconify" data-icon="mdi:home"></span> <a class="menu-link" href="/">主页</a></li><li class="menu-item"><span class="menu-icon iconify" data-icon="mdi:file-document"></span> <a class="menu-link" href="/archives">文章</a></li><li class="menu-item"><span class="menu-icon iconify" data-icon="mdi:magnify"></span> <a class="menu-link" href="/search">搜索</a></li><li class="menu-item"><span class="menu-icon iconify" data-icon="mdi:view-grid"></span> <a class="menu-link" href="/apps/">应用</a></li><li class="menu-item"><span class="menu-icon iconify" data-icon="ri:bilibili-fill"></span> <a class="menu-link" target="_blank" rel="noopener" href="https://space.bilibili.com/14334962">Bilibili</a></li><li class="menu-item"><span class="menu-icon iconify" data-icon="mdi:github-circle"></span> <a class="menu-link" target="_blank" rel="noopener" href="https://github.com/su226">GitHub</a></li></ul></nav><div class="navbar-fixed"><nav class="navbar color-deep-orange"><button class="btn-icon" id="toggle-menu"><span class="iconify" data-icon="mdi:menu"></span></button><div class="navbar-title">Lemon自动AC机</div><button class="btn-icon" id="back-to-top"><span class="iconify" data-icon="mdi:arrow-up"></span></button></nav></div><div id="content"><div id="i18n-data-post" class="i18n-data" data-tab-menu="菜单" data-tab-toc="目录" data-comment-unsupported="抱歉，你的浏览器太旧了，不支持评论区。（评论区至少需要 Chrome 71 / Firefox 65 / Edge 79）"></div><article class="post"><div class="post-header color-deep-orange"><div class="container"><h1 class="post-title">Lemon自动AC机</h1><div class="post-info"><span class="iconify" data-icon="mdi:calendar"></span><ul class="post-date"><li><a href="/archives/2019">2019</a></li><li><a href="/archives/2019/08">8</a></li><li>24</li></ul><div class="post-info-wrap"></div><span class="iconify" data-icon="mdi:folder"></span><ul class="post-categories"><li><a href="/categories/%E8%BD%AF%E4%BB%B6/">软件</a></li></ul><span class="iconify" data-icon="mdi:tag"></span><ul class="post-tags"><li><a class="chip" href="/tags/OI/">OI</a></li><li><a class="chip" href="/tags/C/">C++</a></li></ul></div></div></div><div class="toc" id="toc"><a class="toc-header toc-link" href="#content">Lemon自动AC机</a><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%9F%E8%AF%9D"><span class="toc-text">废话</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%AA%E5%9B%BE"><span class="toc-text">截图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ubuntu"><span class="toc-text">Ubuntu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows"><span class="toc-text">Windows</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-text">代码</span></a></li></ol></div><div class="post-background"><div class="post-content container"><h2 id="废话"><a href="#废话" class="headerlink" title="废话"></a>废话</h2><p>我们机房最近每天都是模拟赛，但我又打不过，于是我动起了歪主意。</p><p>我在机房偷偷看手机时，写了第一个版本的自动AC机。那一个版本只适用于Windows，所以老师发的结果中我爆零。但老师在给另一个同学重测时我是满分，并且重测的截图明显是来自Windows，所以我推测老师是在Linux下打点的。</p><p>从截图和数据包来看，测评软件明显是Lemon，所以我在GitHub上下载了Lemon的修改版<a target="_blank" rel="noopener" href="https://github.com/Dust1404/Project_LemonPlus">LemonPlus</a>。然后我改进了我的AC机，在Windows 10（TDM-GCC 4.9.2）和Ubuntu 19.04（GCC 8.3）测试通过。</p><p>最早我是按输入输出格式去读取数据，但这种方法比较难用。所以我在改进版当中按照字符读取所有输入数据，找到匹配的输入再按字符输出，并且不忽略标准答案中的空格等。</p><h2 id="截图"><a href="#截图" class="headerlink" title="截图"></a>截图</h2><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><p><img src="https://i.loli.net/2019/08/24/xBsNAYiHe53JaD4.png" alt="Ubuntu 测试截图"></p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p><img src="https://i.loli.net/2019/08/24/njxKNEWcGfrs29M.jpg" alt="Windows 测试截图"></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* probname = <span class="string">&quot;**这里改成题目的名字**&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _WIN32 <span class="comment">// 如果是Windows，使用反斜线分割路径，否则用斜线分割路径</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> pathsep = <span class="string">&#x27;\\&#x27;</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> pathsep = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="function">std::string <span class="title">get_filename</span><span class="params">(<span class="keyword">bool</span> out, <span class="keyword">int</span> id = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">  std::ostringstream str; <span class="comment">// 使用标准库中的stringstream格式化路径</span></span><br><span class="line">  <span class="keyword">if</span> (id == <span class="number">0</span>) &#123;</span><br><span class="line">    str &lt;&lt; probname &lt;&lt; <span class="string">&#x27;.&#x27;</span> &lt;&lt; (out ? <span class="string">&quot;out&quot;</span> : <span class="string">&quot;in&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    str &lt;&lt; <span class="string">&quot;..&quot;</span> &lt;&lt; pathsep &lt;&lt; <span class="string">&quot;..&quot;</span> &lt;&lt; pathsep &lt;&lt; <span class="string">&quot;data&quot;</span> &lt;&lt; pathsep &lt;&lt; probname &lt;&lt; pathsep &lt;&lt; id &lt;&lt; <span class="string">&#x27;.&#x27;</span> &lt;&lt; (out ? <span class="string">&quot;out&quot;</span> : <span class="string">&quot;in&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str.<span class="built_in">str</span>(); <span class="comment">// 返回值是string，在外面调用c_str方法，在内部调用c_str并返回const char*可能出错</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_stream</span><span class="params">(std::istream&amp; fin, std::istream&amp; tin)</span> </span>&#123;</span><br><span class="line">  fin.<span class="built_in">seekg</span>(<span class="number">0</span>); <span class="comment">// 要让比对的流回到开始点，被比对的流不需要，因为新打开的流就是从开始点开始的</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">char</span> ch = fin.<span class="built_in">get</span>(), ch2 = tin.<span class="built_in">get</span>(); ch != <span class="number">-1</span> &amp;&amp; ch2 != <span class="number">-1</span>; ch = fin.<span class="built_in">get</span>(), ch2 = tin.<span class="built_in">get</span>()) &#123; <span class="comment">// 这里要两个流同时结尾时才停止比对，防止一个流是另一个流的前缀时出错，并且get方法出错时返回-1，并不会抛出异常，所以不会出错</span></span><br><span class="line">    <span class="keyword">if</span> (ch != ch2) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function">std::ifstream <span class="title">fin</span><span class="params">(get_filename(<span class="literal">false</span>).c_str())</span></span>; <span class="comment">// C++的文件流，远比cin/cout+freopen快，就算是不与stdio同步的cin/cout也比fstream慢，还像cin一样好用</span></span><br><span class="line">  <span class="function">std::ofstream <span class="title">fout</span><span class="params">(get_filename(<span class="literal">true</span>).c_str())</span></span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;; i++) &#123;</span><br><span class="line">    <span class="function">std::ifstream <span class="title">tin</span><span class="params">(get_filename(<span class="literal">false</span>, i).c_str())</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!tin.<span class="built_in">is_open</span>()) &#123; <span class="comment">// 如果打不开文件，说明没有这个测试点（当然也可能是脸黑遇到了神秘bug），以后的测试点自然也没有，所以就可以不循环了。</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">check_stream</span>(fin, tin)) &#123;</span><br><span class="line">      std::ifstream <span class="built_in">tout</span>(<span class="built_in">get_filename</span>(<span class="literal">true</span>, i).<span class="built_in">c_str</span>());</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">char</span> ch = tout.<span class="built_in">get</span>(); ch != <span class="number">-1</span>; ch = tout.<span class="built_in">get</span>()) &#123;</span><br><span class="line">        fout &lt;&lt; ch;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// main返回值非0会被Lemon视作运行时错误，也许可以用来判断你是否遇到了神秘bug。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></article><div class="container giscus-wrap"><script id="giscus-script" data-repo="su226/su226.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxOTgzMjQyNTk=" data-category="Announcements" data-category-id="DIC_kwDOC9IwI84B_VPa" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-lang="zh-CN" data-theme="light" crossorigin="anonymous" async></script></div><div id="footer">由 <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> 强力驱动，托管于 <a target="_blank" rel="noopener" href="https://vercel.com/">Vercel</a>（<a target="_blank" rel="noopener" href="https://gh.su226.tk">备用线路</a>托管于 <a target="_blank" rel="noopener" href="https://pages.github.com/">Github Pages</a>）</div></div><ul id="settings-dialog"><li data-select="scheme" data-default="auto"><button data-option="auto"><span class="iconify" data-icon="mdi:check"></span></button> <button data-option="multi"><span class="iconify" data-icon="mdi:check"></span></button> <button data-option="single"><span class="iconify" data-icon="mdi:check"></span></button> <button data-option="sepia"><span class="iconify" data-icon="mdi:check"></span></button> <button data-option="dark"><span class="iconify" data-icon="mdi:check"></span></button></li><li data-select="font" data-default="sans"><button data-option="sans">Aa</button> <button data-option="serif">Aa</button> <button data-option="mono">Aa</button></li><li><div data-adjust="size"><button data-minus><span class="iconify" data-icon="mdi:minus"></span></button><div class="subgroup-label"><span class="iconify" data-icon="mdi:format-size"></span><span data-label></span></div><button data-plus><span class="iconify" data-icon="mdi:plus"></span></button></div><div data-adjust="width"><button data-minus><span class="iconify" data-icon="mdi:minus"></span></button><div class="subgroup-label"><span class="iconify" data-icon="mdi:arrow-left-right"></span><span data-label></span></div><button data-plus><span class="iconify" data-icon="mdi:plus"></span></button></div><div data-adjust="line"><button data-minus><span class="iconify" data-icon="mdi:minus"></span></button><div class="subgroup-label"><span class="iconify" data-icon="mdi:arrow-expand-vertical"></span><span data-label></span></div><button data-plus><span class="iconify" data-icon="mdi:plus"></span></button></div></li></ul><script src="https://polyfill.io/v3/polyfill.min.js?features=Array.from%2CArray.prototype.%40%40iterator%2Cdocument.currentScript%2CPromise%2Cfetch%2CElement.prototype.replaceWith%2CElement.prototype.classList%2CElement.prototype.remove%2Cwindow.scroll%2CCustomEvent%2CObject.values%2CObject.entries"></script><script src="https://code.iconify.design/2/2.0.4/iconify.min.js" async></script><script src="/js/waves-0.7.6-min.js"></script><script src="/js/regenerator-runtime-0.13.9-min.js"></script><script src="/js/base.js"></script><script src="/js/post.js"></script></body></html>